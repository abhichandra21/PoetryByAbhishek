# Repository Guidelines

## Project Structure & Module Organization
- `src/` hosts React + TypeScript code; keep new UI in `src/components/`, helper logic in `src/lib/`, shared types in `src/types/`, hooks in `src/hooks/`.
- `src/data/poems.json` and the `poems/` directory hold canonical poem metadata; update both together when adding works.
- `public/` serves static assets; `dist/` is generated by builds and should stay untracked in commits.
- Automation scripts sit in `scripts/` (dictionary, sitemap, email); tests live in `src/lib/__tests__` with `*.test.ts` naming.

## Build, Test, and Development Commands
- `npm run dev` runs the dictionary freshness check then starts Vite; visit http://localhost:5173 to verify live changes.
- `npm run build` executes `tsc -b` and `vite build`, regenerating the sitemap and dictionary cache via the `prebuild` hook.
- `npm run lint` enforces ESLint’s TypeScript + React rules; run before opening a pull request.
- `npm run test` launches Vitest in watch mode by default; add `--run` for a single pass in CI.
- `npm run check:dictionary` warns if `src/data/poems.json` outpaces the generated cache; follow with `npm run generate:dictionary` when flagged.

## Coding Style & Naming Conventions
- Use TypeScript everywhere, prefer functional components, and export modules via ES modules.
- Follow 2-space indentation, single quotes, and PascalCase component filenames (e.g. `PoemBook.tsx`); hooks stay in `src/hooks` named with `use` prefixes.
- Run `npm run lint` after changes; avoid committing commented-out debugging unless explicitly documented.

## Testing Guidelines
- Write unit tests with Vitest alongside the module under test (e.g. `src/lib/__tests__/session.test.ts`).
- Use descriptive `describe` blocks mirroring the API surface; focus on analytics, session, and dictionary flows when altering them.
- Ensure `npm run test -- --coverage` remains stable when touching core utilities; add scenarios for new dictionary sources.

## Commit & Pull Request Guidelines
- Craft concise, present-tense commit subjects (`Revise tooltip fetch logic…`); group related changes rather than stacking WIP commits.
- For pull requests, include: overview of user-visible impact, steps to reproduce or verify, dictionary cache status, and relevant screenshots for UI updates.
- Reference linked issues or docs (e.g. `REKHTA_SETUP.md`) when dependencies or environment changes are required; note any manual scripts to rerun.

## Security & Configuration Tips
- Store Supabase, SMTP, and analytics secrets in `.env.local`; never commit credentials or personal poem drafts.
- When debugging dictionary providers, limit console logging to development sessions and remove temporary logs before merging.
